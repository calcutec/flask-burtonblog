define(["jquery","backbone","nunjucks","collections/photoCollection","views/baseView","views/uploadFormView"],function(e,t,o,n,i,s){return t.Router.extend({initialize:function(){var n=e("meta[name=csrf-token]").attr("content");e(function(){e.ajaxSetup({beforeSend:function(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",n)}})}),window.env=o.configure("../templates"),env.addGlobal("static_url","https://s3.amazonaws.com/aperturus/"),this.initial=!0,t.history.start({pushState:!0}),t.View.prototype.close=function(){this.remove(),e(this.el).empty(),this.unbind(),this.undelegateEvents(),delete this}},routes:{"":"home","home(/)":"home","photos(/)":"photos","photos/all(/)":"photos","photos/latest":"photos","photos/upload(/)":"upload","photos/:category(/)":"photos","members(/)":"members","members/all(/)":"members","members/latest(/)":"members","members/:username(/)":"member","members/:username/all(/)":"member","members/:username/latest(/)":"member","members/:username/:category(/)":"member"},getItemDict:function(){return{route:null,collection:null,category:null,entity:null,nickname:null,authenticated:null,count:null,postId:null,template:null,render:null}},photo:function(e){console.log(e)},home:function(){this.initial?(this.initial=!1,this.refreshdata("home")):(console.log("home rerouting"),window.location=t.history.location.href)},photos:function(e){this.initial?(this.initial=!1,e&&e.match(/^\d+$/)?this.refreshdata("photo"):this.refreshdata("photos")):(console.log("photos rerouting"),window.location=t.history.location.href)},upload:function(){new s},members:function(){this.initial?(this.initial=!1,this.refreshdata("members")):(console.log("members rerouting"),window.location=t.history.location.href)},member:function(e){this.initial?(this.initial=!1,this.refreshdata("member",e)):(console.log("members rerouting"),window.location=t.history.location.href)},refreshdata:function(e,t){var o=new n;o.fetch({success:function(){var n={};window.env.addGlobal("current_user",n),n.is_authenticated=function(){return o.authenticated},n.nickname=o.usernickname,new i({photoCollection:o,el:"#thisgreatpic",pageType:e,username:t})},fail:function(e){console.log(e)}})}})});