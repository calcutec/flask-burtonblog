define(["jquery","backbone"],function(e,i){return i.View.extend({el:"#image-preview",result:e("#result"),exifNode:e("#exif"),thumbNode:e("#thumbnail"),currentFile:null,coordinates:null,initialize:function(){(window.createObjectURL||window.URL||window.webkitURL||window.FileReader)&&this.result.children().hide()},events:{"change #file-input":"dropChangeHandler"},dropChangeHandler:function(e){e.preventDefault(),e=e.originalEvent;var i=e.dataTransfer||e.target,t=i&&i.files&&i.files[0],a={maxWidth:this.result.width(),canvas:!0,pixelRatio:window.devicePixelRatio,downsamplingRatio:.5};if(t){this.exifNode.hide(),this.thumbNode.hide();var n=this;window.loadImage.parseMetaData(t,function(e){e.exif&&(a.orientation=e.exif[274],n.displayExifData(e.exif)),n.displayImage(t,a)})}},displayExifData:function(i){var t,a=(i.get("Thumbnail"),i.getAll()),n=this.exifNode.find("table").empty(),r=e("<tr></tr>"),o=e("<td></td>");for(t in a)a.hasOwnProperty(t)&&t in{Make:"",Model:"",DateTime:"",ShutterSpeedValue:"",FNumber:"",ExposureProgram:"",PhotographicSensitivity:"",FocalLength:"",FocalLengthIn35mmFilm:"",LensModel:"",Sharpness:"",PixelXDimension:"",PixelYDimension:"",Orientation:""}&&n.append(r.clone().append(o.clone().text(t)).append(o.clone().text(a[t])));this.exifNode.show()},displayImage:function(i,t){window.currentFile=i,loadImage(i,this.replaceResults,t)||this.result.children().replaceWith(e("<span>Your browser does not support the URL or FileReader API.</span>"))},replaceResults:function(i){var t;t=i.src||i instanceof HTMLCanvasElement?e('<a target="_blank">').append(i).attr("download",currentFile.name).attr("href",i.src||i.toDataURL()):e("<span>Loading image file failed</span>"),e("#result").children().replaceWith(t),e("#photo-submit").removeClass("hide")}})});